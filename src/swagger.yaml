openapi: 3.0.3
info:
  title: Financial AI API
  description: API REST para gerenciamento de usuários com sistema de autenticação JWT e verificação de email
  version: 1.0.0
  contact:
    name: Felipe Alves
    url: https://github.com/Projeto-Financeiro-com-IA-Integrada
    email: your-email@example.com

servers:
  - url: http://localhost:3000
    description: Servidor de desenvolvimento
  - url: https://api.production.com
    description: Servidor de produção

tags:
  - name: Authentication
    description: Endpoints públicos para autenticação e registro
  - name: Profile
    description: Endpoints protegidos para gerenciamento de perfil do usuário

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token obtido após login bem-sucedido

  schemas:
    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: "123e4567-e89b-12d3-a456-426614174000"
        email:
          type: string
          format: email
          example: "usuario@example.com"
        name:
          type: string
          example: "João Silva"
        isVerified:
          type: boolean
          example: true
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    RegisterRequest:
      type: object
      required:
        - email
        - name
        - password
      properties:
        email:
          type: string
          format: email
          example: "usuario@example.com"
        name:
          type: string
          minLength: 2
          example: "João Silva"
        password:
          type: string
          minLength: 6
          pattern: "^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d).+$"
          example: "Senha123"
          description: Deve conter pelo menos 6 caracteres, uma letra maiúscula, uma minúscula e um número

    VerifyEmailRequest:
      type: object
      required:
        - email
        - code
      properties:
        email:
          type: string
          format: email
          example: "usuario@example.com"
        code:
          type: string
          minLength: 6
          maxLength: 6
          example: "123456"
          description: Código de 6 dígitos enviado por email

    LoginRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
          example: "usuario@example.com"
        password:
          type: string
          minLength: 6
          example: "Senha123"

    LoginResponse:
      type: object
      properties:
        token:
          type: string
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        user:
          $ref: '#/components/schemas/User'

    ResendCodeRequest:
      type: object
      required:
        - email
      properties:
        email:
          type: string
          format: email
          example: "usuario@example.com"

    UpdateProfileRequest:
      type: object
      properties:
        name:
          type: string
          minLength: 3
          example: "João Silva Santos"
        currentPassword:
          type: string
          example: "SenhaAtual123"
          description: Obrigatório apenas se newPassword for fornecida
        newPassword:
          type: string
          minLength: 8
          pattern: "^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d).+$"
          example: "NovaSenha123"
          description: Deve conter pelo menos 8 caracteres, uma letra maiúscula, uma minúscula e um número

    RequestEmailChangeRequest:
      type: object
      required:
        - newEmail
      properties:
        newEmail:
          type: string
          format: email
          example: "novoemail@example.com"

    ConfirmEmailChangeRequest:
      type: object
      required:
        - newEmail
        - verificationCode
      properties:
        newEmail:
          type: string
          format: email
          example: "novoemail@example.com"
        verificationCode:
          type: string
          minLength: 6
          maxLength: 6
          example: "123456"

    RequestAccountDeletionRequest:
      type: object
      required:
        - password
      properties:
        password:
          type: string
          example: "Senha123"

    ConfirmAccountDeletionRequest:
      type: object
      required:
        - verificationCode
      properties:
        verificationCode:
          type: string
          minLength: 6
          maxLength: 6
          example: "123456"

    ErrorResponse:
      type: object
      properties:
        error:
          type: string
          example: "Mensagem de erro"
        details:
          type: array
          items:
            type: object
            properties:
              field:
                type: string
              message:
                type: string

    SuccessResponse:
      type: object
      properties:
        message:
          type: string
          example: "Operação realizada com sucesso"

paths:
  /auth/register:
    post:
      tags:
        - Authentication
      summary: Registrar novo usuário
      description: Cria uma nova conta de usuário e envia código de verificação por email
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
      responses:
        '201':
          description: Usuário criado com sucesso
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Usuário registrado! Verifique seu email."
                  userId:
                    type: string
                    format: uuid
        '400':
          description: Dados inválidos
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: Email já cadastrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /auth/verify-email:
    post:
      tags:
        - Authentication
      summary: Verificar email
      description: Verifica o email do usuário com o código de 6 dígitos enviado
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VerifyEmailRequest'
      responses:
        '200':
          description: Email verificado com sucesso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          description: Código inválido ou expirado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Usuário não encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /auth/login:
    post:
      tags:
        - Authentication
      summary: Realizar login
      description: Autentica o usuário e retorna token JWT
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Login realizado com sucesso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        '401':
          description: Credenciais inválidas
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Email não verificado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /auth/resend-code:
    post:
      tags:
        - Authentication
      summary: Reenviar código de verificação
      description: Reenvia o código de verificação para o email do usuário
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ResendCodeRequest'
      responses:
        '200':
          description: Código reenviado com sucesso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '404':
          description: Usuário não encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '400':
          description: Email já verificado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /profile:
    get:
      tags:
        - Profile
      summary: Obter perfil do usuário
      description: Retorna os dados do perfil do usuário autenticado
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Dados do perfil
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          description: Não autenticado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    patch:
      tags:
        - Profile
      summary: Atualizar perfil
      description: Atualiza nome e/ou senha do usuário autenticado
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateProfileRequest'
      responses:
        '200':
          description: Perfil atualizado com sucesso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          description: Dados inválidos ou senha atual incorreta
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Não autenticado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /profile/email/request:
    post:
      tags:
        - Profile
      summary: Solicitar mudança de email
      description: Envia código de verificação para o novo email
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RequestEmailChangeRequest'
      responses:
        '200':
          description: Código enviado para o novo email
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          description: Email inválido
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Não autenticado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: Email já está em uso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /profile/email/confirm:
    patch:
      tags:
        - Profile
      summary: Confirmar mudança de email
      description: Confirma a mudança de email com o código de verificação
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ConfirmEmailChangeRequest'
      responses:
        '200':
          description: Email alterado com sucesso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          description: Código inválido ou expirado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Não autenticado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /profile/delete/request:
    post:
      tags:
        - Profile
      summary: Solicitar exclusão de conta
      description: Envia código de confirmação por email para exclusão da conta
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RequestAccountDeletionRequest'
      responses:
        '200':
          description: Código de confirmação enviado por email
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          description: Senha incorreta
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Não autenticado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /profile/delete/confirm:
    delete:
      tags:
        - Profile
      summary: Confirmar exclusão de conta
      description: Confirma e executa a exclusão permanente da conta do usuário
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ConfirmAccountDeletionRequest'
      responses:
        '200':
          description: Conta excluída com sucesso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          description: Código inválido ou expirado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Não autenticado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
